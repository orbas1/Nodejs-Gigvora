# Routes Updates — Version 1.50 Update

| Route | Change | Notes |
|-------|--------|-------|
| `GET /health/live` | **New.** Returns liveness payload for container orchestrators; excludes heavy dependency checks so it can be polled at high frequency. | Backed by `services/healthService.getLivenessReport()` and the runtime health tracker. |
| `GET /health/ready` | **New.** Surfaces dependency-aware readiness, including Sequelize connectivity and worker states. Emits `503` when degraded or during shutdown. | Consumers should migrate from legacy `/health` to this path for granular telemetry. |
| `GET /health` | Updated. Now proxies to `/health/ready` to preserve compatibility while delivering enriched telemetry. | Documented for load balancers and mobile clients. |
| `GET /health/metrics` | **New.** Streams Prometheus-formatted metrics (exporter health, scrape counters, rate-limit/WAF totals, Sequelize pool gauges) with cache-control headers disabled for collectors. | Built on `observability/metricsRegistry.js` with exporter priming during server bootstrap so scrapes return immediately after deploys. |
| `GET /api/admin/runtime/health` | Updated. Returns aggregated readiness, liveness, dependency, maintenance, WAF, and rate-limit telemetry for admin operators. | Now surfaces web application firewall metrics, auto-block quarantine data, recent block samples, and perimeter totals alongside existing runtime data for dashboards and mobile clients. |
| `GET /api/docs/runtime-security` | **New.** Serves the hashed OpenAPI document for health and authentication endpoints with five-minute cache headers and ETag validation. | Enables partner tooling, SDK generators, and ops automation to consume the documented contract without scraping controllers. |
| `HEAD /api/docs/runtime-security` | **New.** Provides checksum headers for the runtime OpenAPI document without streaming the payload. | Release automation can detect spec changes and trigger documentation workflows without downloading the full schema. |
| `POST /auth/refresh` | **New.** Issues a fresh access token and session payload when presented with a valid refresh token. | Powers secure mobile/web session bootstrap without requiring repeated credential entry; audited via `refresh_token_issued` login events. |
| `GET /api/runtime/maintenance` | **New.** Public endpoint returning active and upcoming maintenance announcements filtered by audience/channel with caching hints for web/mobile surfaces. | Powered by `runtimeMaintenanceService.fetchActiveAnnouncements()` and Zod query validation. |
| `GET /api/admin/runtime/maintenance` | **New.** Lists maintenance announcements for operations staff with pagination, filtering by status/audience/channel, and includes resolved history when requested. | Protected by admin auth; responses include actor metadata and scheduling fields for dashboards. |
| `POST /api/admin/runtime/maintenance` | **New.** Creates a maintenance announcement with server-side sanitisation of copy, severity, schedules, and channel/audience targeting. | Enforces chronology, slug deduplication, and metadata validation before persistence. |
| `PUT /api/admin/runtime/maintenance/:announcementId` | **New.** Replaces an announcement payload, revalidating copy, scheduling, channel targeting, and severity without losing actor metadata. | Guards against regressions by requiring valid date order and slug uniqueness. |
| `PATCH /api/admin/runtime/maintenance/:announcementId` | **New.** Partial update endpoint allowing copy tweaks, schedule adjustments, and metadata changes while preserving history. | Uses targeted merge logic so unspecified fields remain intact; forbids invalid status transitions. |
| `PATCH /api/admin/runtime/maintenance/:announcementId/status` | **New.** Dedicated status transition endpoint allowing operations to toggle between draft/scheduled/active/resolved with guardrails. | Rejects invalid state transitions (e.g., resolving before activation) and auto-sets timestamps. |
| `GET /api/domains/registry` | **New.** Provides a registry snapshot of bounded contexts, associated services, and sampled model attributes. | Designed for admin dashboards and tooling to verify coverage before migrations. |
| `GET /api/domains/:context` | **New.** Returns context metadata plus serialised model definitions (attributes, indexes, hooks, associations). | Supports engineering review of schema churn and contract drift. |
| `GET /api/domains/:context/models/:modelName` | **New.** Serves a specific model definition pulled from the bounded context. | Enables targeted schema validation in CI and documentation pipelines. |
| `GET /api/domains/governance` | **New.** Returns governance summaries (contexts by status, remediation backlog, next-review cadence) merged from metadata and review records. | Powers admin dashboards, audit tooling, and policy automation consuming the shared governance schema; Supertest coverage added 24 Apr verifies merged review metadata and response envelope. |
| `GET /api/domains/:context/governance` | **New.** Delivers detailed governance payloads per context, including steward contacts, classification, PII inventories, review history, and outstanding remediation tasks. | Enables operators to chase remediation deadlines and align data catalogues with the modularised domains; route tests assert persisted reviews, PII counts, and 404 handling. |
| `POST /api/auth/*` | Updated. Requests now pass through Zod schemas that trim names, coerce booleans/numbers, and reject malformed payloads before controller logic runs. | Applies to registration, login, two-factor verification/resend, and Google OAuth entry points. |
| `GET /api/admin/dashboard` | Updated. Query params (`lookbackDays`, `eventWindowDays`) are parsed as bounded integers and defaulted safely when omitted. | Prevents negative/NaN values from reaching the dashboard service. |
| `PUT /api/admin/platform-settings` | Updated. Nested commission/payment/smtp structures are validated, with numeric and boolean coercion before persisting settings. | Blocks prototype pollution and invalid provider payloads. |
| `PUT /api/admin/affiliate-settings` | Updated. Tiers, payouts, and compliance settings are normalised through schemas enforcing ranges, strings, and recurrence contracts. | Guards affiliate configuration against missing names, out-of-range rates, and invalid recurrence windows. |
| `GET /api/search` | Updated. Enforces bounded numeric limits and trims search queries before delegating to discovery snapshots or Meilisearch. | Prevents excessive page sizes and empty queries from reaching the discovery service. |
| `GET /api/search/opportunities` | Updated. Canonicalises category aliases, validates JSON filters/viewports, coerces pagination, and respects boolean facet toggles through validation middleware. | Shields discovery services from malformed filters, invalid bounding boxes, and unsafe query strings. |
| `POST /api/search/subscriptions` | Updated. Requires trimmed names, canonical categories, validated filters, and boolean preferences before creating saved searches. | Blocks malformed subscription payloads and normalises defaults for notification channels and frequency. |
| `PATCH /api/search/subscriptions/:id` | Updated. Ensures numeric IDs, trims optional fields, validates frequency enums, and sanitises JSON filters on updates. | Prevents invalid identifiers and unsafe filter payloads from reaching the subscription service. |
| `DELETE /api/search/subscriptions/:id` | Updated. Validates numeric identifiers before attempting deletion. | Eliminates silent failures caused by malformed params. |
| `POST /api/projects` | Updated. Applies schema validation to require titles/descriptions, coerce actor IDs, normalise geo/budget payloads, and sanitise auto-assign settings. | Guarantees project creation flows receive production-ready payloads with consistent numeric/boolean types. |
| `PATCH /api/projects/:projectId` | Updated. Validates identifiers and trims/sanitises partial updates including budget currency, status, and nested auto-assign settings. | Prevents empty updates and enforces canonical status/currency formatting before persistence. |
| `PATCH /api/projects/:projectId/auto-assign` | Updated. Requires numeric project IDs, coerces actor IDs and budgets, and merges nested settings into a canonical auto-assign payload. | Stops queue regeneration with invalid limits/weights and ensures booleans are explicit. |
| `GET /api/projects/:projectId/events` | Updated. Validates project identifiers and bounds the events `limit` parameter to safe integers. | Avoids negative or non-numeric limits from hitting the events service. |
| `GET /api/finance/control-tower/overview` | Updated. Coerces user IDs, validates ISO date filters, and normalises refresh flags before computing the finance overview. | Prevents invalid dates and identifiers from bypassing the finance guardrails and cache keying. |
| `GET /api/finance/freelancers/:freelancerId/insights` | Updated. Validates freelancer identifiers as positive integers before fetching insights. | Stops invalid path parameters from triggering needless service lookups. |
| `POST /api/compliance/documents` | Updated. Applies Zod validation to reject malformed payloads with `422` responses and halts creation with typed `503` errors when compliance storage guard flags missing credentials or maintenance, returning request correlation IDs for auditing. | Ensures legal artefacts are never persisted while secure storage is degraded and keeps stored documents sanitised; backed by new supertest coverage. |
| `GET /api/users/:id` | Updated. Surfaces `503` responses when wallet provisioning cannot proceed because the payments dependency guard detects credential gaps or maintenance windows. | Prevents profile reads from masking degraded payment infrastructure and is exercised through end-to-end guard propagation tests. |
| `GET /api/admin/governance/consents` | **New.** Lists consent policies with filters for jurisdiction, channel, status, and effective window while returning active version metadata. | Protected by admin RBAC; responses use consent schema contracts, support CSV export hints for legal teams, and now carry 28 Apr Supertest coverage validating filter combinations and version payloads. |
| `POST /api/admin/governance/consents` | **New.** Creates consent policies with initial draft versions, validating legal basis, slug uniqueness, and jurisdiction scoping. | Rejects malformed payloads through Zod schemas, records immutable audit events when policies are registered, and is verified by route tests covering transactional creation paths (28 Apr). |
| `POST /api/admin/governance/consents/:policyId/versions` | **New.** Publishes additional policy versions with locale manifests, channel targeting, and effective dates. | Guards against overlapping activation windows, enforces sequential version numbers, enqueues backfill jobs for active users, and now has regression tests ensuring activation metadata is returned (28 Apr). |
| `PATCH /api/admin/governance/consents/:policyId` | **New.** Allows metadata updates to draft policies (title, summary, legal basis) while preserving immutable audit history for published versions. | Returns structured validation errors for unsafe edits, blocks changes when a policy has active versions, and is exercised by new Supertest coverage confirming retention updates (28 Apr). |
| `POST /api/admin/governance/consents/:policyId/activate` | **New.** Activates a specific policy version globally or for a jurisdiction subset with transactional backfills of outstanding user consents. | Rejects activation without a published version or when prerequisites fail, emitting audit events and downstream notification tasks. |
| `GET /api/users/:userId/consents` | **New.** Returns a user’s consent ledger with current status, outstanding required policies, and audit timeline entries. | Enforces user RBAC, supports SAR export flags, hydrates summaries via `consentService.getUserConsentSnapshot`, and now has 28 Apr Supertest coverage verifying audience/region filters plus persisted metadata. |
| `PUT /api/users/:userId/consents/:policyCode` | **New.** Records or withdraws consent decisions against the active policy version with locale, channel, and metadata payloads. | Validates policy availability, enforces revocation guardrails, emits audit events with correlation IDs, and regression tests confirm idempotent grants plus withdrawal transitions (28 Apr). |
